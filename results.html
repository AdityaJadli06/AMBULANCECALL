<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Results - Nearest Hospitals</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCHmxxW-gWoCgs6CUObO8YBVH4w3V5VnU4&libraries=places"></script>
</head>
<body>
    <a href="booking.html" class="back-btn" title="Back to Booking">‚Üê</a>
    
    <div class="section-container">
        <h2>üè• Nearest Hospitals</h2>
        
        <div id="bookingInfo" class="status-message status-info" style="margin-bottom: 2rem;">
            <h3 style="margin-bottom: 0.5rem; color: #00d4ff;">üìã Your Booking Details</h3>
            <div id="bookingDetails"></div>
        </div>
        
        <div id="hospitalList" class="button-grid">
            <!-- Hospitals will be dynamically loaded here -->
        </div>
        
        <div class="feature-card" style="margin-top: 2rem; background: rgba(0, 255, 133, 0.1); border-color: rgba(0, 255, 133, 0.3);">
            <h3 style="color: #00ff85;">‚úÖ What Happens Next?</h3>
            <div style="text-align: left; color: #a1a1aa; line-height: 1.6;">
                <p>1. <strong>Call the ambulance</strong> using the phone number provided</p>
                <p>2. <strong>Confirm your exact location</strong> with the driver</p>
                <p>3. <strong>Prepare necessary documents</strong> (ID, insurance cards)</p>
                <p>4. <strong>Stay calm</strong> and wait for the ambulance to arrive</p>
            </div>
        </div>
        
        <div class="button-grid" style="margin-top: 2rem;">
            <a href="firstaid.html" class="btn-secondary">
                ü©π First Aid Guide
            </a>
            <a href="track-by-booking-id.html" class="btn-primary">
                üîç Track This Booking
            </a>
        </div>
    </div>

    <div id="map" style="height: 400px; margin-top: 2rem;"></div>

    <script>
        // Mock hospital data - In real implementation, this would come from your backend API
        const mockHospitals = [
            {
                id: 1,
                name: "City General Hospital",
                distance: "1.2 km",
                address: "123 Main Street, City Center",
                phone: "+91 98765 43210",
                specialties: ["Emergency Care", "Cardiology", "Trauma"],
                rating: 4.5,
                estimatedTime: "8-12 min"
            },
            {
                id: 2,
                name: "Metro Medical Center",
                distance: "2.1 km",
                address: "456 Health Avenue, Metro District",
                phone: "+91 98765 43211",
                specialties: ["ICU", "Surgery", "Pediatrics"],
                rating: 4.3,
                estimatedTime: "12-18 min"
            },
            {
                id: 3,
                name: "Regional Emergency Hospital",
                distance: "2.8 km",
                address: "789 Care Boulevard, Regional Area",
                phone: "+91 98765 43212",
                specialties: ["Trauma Center", "Neurology", "Orthopedics"],
                rating: 4.7,
                estimatedTime: "15-22 min"
            },
            {
                id: 4,
                name: "Community Health Center",
                distance: "3.5 km",
                address: "321 Wellness Road, Community Zone",
                phone: "+91 98765 43213",
                specialties: ["General Medicine", "Emergency", "Maternity"],
                rating: 4.1,
                estimatedTime: "18-25 min"
            },
            {
                id: 5,
                name: "Advanced Care Hospital",
                distance: "4.2 km",
                address: "654 Medical Plaza, Advanced District",
                phone: "+91 98765 43214",
                specialties: ["Critical Care", "Oncology", "Cardiothoracic"],
                rating: 4.6,
                estimatedTime: "22-30 min"
            }
        ];

        // Display booking information
        function displayBookingInfo() {
            const bookingData = JSON.parse(localStorage.getItem('currentBooking') || '{}');
            const detailsDiv = document.getElementById('bookingDetails');
            
            if (bookingData.bookingId) {
                detailsDiv.innerHTML = `
                    <p><strong>Booking ID:</strong> ${bookingData.bookingId}</p>
                    <p><strong>Location:</strong> ${bookingData.location}</p>
                    <p><strong>Phone:</strong> ${bookingData.phone}</p>
                    ${bookingData.emergency ? `<p><strong>Emergency:</strong> ${bookingData.emergency}</p>` : ''}
                    <p><strong>Time:</strong> ${new Date(bookingData.timestamp).toLocaleString()}</p>
                `;
            } else {
                detailsDiv.innerHTML = '<p>No booking information available</p>';
            }
        }

        // Display hospitals
        function displayHospitals() {
            const hospitalListDiv = document.getElementById('hospitalList');
            
            hospitalListDiv.innerHTML = mockHospitals.map(hospital => `
                <div class="feature-card hospital-card" style="text-align: left; position: relative;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                        <h3 style="color: #00d4ff; margin: 0; flex: 1;">${hospital.name}</h3>
                        <div style="text-align: right; color: #00ff85; font-weight: 600;">
                            <div style="font-size: 1.1rem;">${hospital.distance}</div>
                            <div style="font-size: 0.9rem; color: #a1a1aa;">‚è±Ô∏è ${hospital.estimatedTime}</div>
                        </div>
                    </div>
                    
                    <p style="color: #a1a1aa; margin: 0.5rem 0; font-size: 0.95rem;">
                        üìç ${hospital.address}
                    </p>
                    
                    <div style="margin: 1rem 0;">
                        <div style="color: #71717a; font-size: 0.9rem; margin-bottom: 0.5rem;">
                            <strong>Specialties:</strong> ${hospital.specialties.join(', ')}
                        </div>
                        <div style="color: #ffd700; font-size: 0.9rem;">
                            ‚≠ê ${hospital.rating}/5.0
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                        <a href="tel:${hospital.phone}" 
                           class="btn-secondary" 
                           style="flex: 1; text-decoration: none; display: flex; align-items: center; justify-content: center; padding: 0.875rem;">
                            üìû Call Ambulance
                        </a>
                        <button onclick="getDirections('${hospital.address}')" 
                                class="btn-primary" 
                                style="flex: 1; font-size: 0.9rem;">
                            üó∫Ô∏è Directions
                        </button>
                    </div>
                    
                    <div style="margin-top: 1rem; font-size: 0.9rem; color: #a1a1aa; text-align: center;">
                        <strong style="color: #00d4ff;">üìû ${hospital.phone}</strong>
                    </div>
                </div>
            `).join('');
        }

        // Get directions function
        function getDirections(hospitalAddress) {
            const bookingData = JSON.parse(localStorage.getItem('currentBooking') || '{}');
            const userLocation = bookingData.location || '';
            
            // Create Google Maps directions URL
            const mapsUrl = `https://www.google.com/maps/dir/${encodeURIComponent(userLocation)}/${encodeURIComponent(hospitalAddress)}`;
            
            // Open in new tab
            window.open(mapsUrl, '_blank');
        }

        // Emergency call function
        function callEmergency() {
            if (confirm('This will dial the national emergency number 108. Continue?')) {
                window.location.href = 'tel:108';
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            displayBookingInfo();
            displayHospitals();
        });

        // Add some interactive features
        document.addEventListener('DOMContentLoaded', function() {
            // Add emergency call button
            const emergencyBtn = document.createElement('div');
            emergencyBtn.innerHTML = `
                <button onclick="callEmergency()" 
                        style="position: fixed; bottom: 2rem; right: 2rem; background: linear-gradient(135deg, #ff007b, #ff00d4); color: white; border: none; border-radius: 50%; width: 70px; height: 70px; font-size: 2rem; cursor: pointer; box-shadow: 0 8px 24px rgba(255, 0, 123, 0.4); z-index: 1000; transition: all 0.3s ease;"
                        onmouseover="this.style.transform='scale(1.1)'"
                        onmouseout="this.style.transform='scale(1)'"
                        title="Call Emergency 108">
                    üö®
                </button>
            `;
            document.body.appendChild(emergencyBtn);
        });

        function initMap() {
            const userLat = parseFloat(localStorage.getItem("latitude"));
            const userLon = parseFloat(localStorage.getItem("longitude"));

            const map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: userLat, lng: userLon },
                zoom: 12,
            });

            const userMarker = new google.maps.Marker({
                position: { lat: userLat, lng: userLon },
                map: map,
                title: "Your Location",
            });

            // Fetch nearby hospitals using Google Places API
            const service = new google.maps.places.PlacesService(map);
            const request = {
                location: { lat: userLat, lng: userLon },
                radius: 5000, // 5 km radius
                type: ["hospital"],
            };

            service.nearbySearch(request, (results, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    const hospitalListDiv = document.getElementById("hospitalList");
                    hospitalListDiv.innerHTML = "";

                    results.slice(0, 5).forEach((place) => {
                        const hospitalCard = document.createElement("div");
                        hospitalCard.className = "feature-card hospital-card";
                        hospitalCard.innerHTML = `
                            <h3>${place.name}</h3>
                            <p>üìç ${place.vicinity}</p>
                            <p>‚≠ê ${place.rating || "N/A"}/5.0</p>
                            <a href="https://www.google.com/maps/dir/?api=1&destination=${place.geometry.location.lat()},${place.geometry.location.lng()}" target="_blank" class="btn-secondary">üìç Get Directions</a>
                        `;
                        hospitalListDiv.appendChild(hospitalCard);

                        // Add hospital marker to the map
                        new google.maps.Marker({
                            position: place.geometry.location,
                            map: map,
                            title: place.name,
                        });
                    });
                } else {
                    console.error("Places API error:", status);
                }
            });
        }

        // Initialize the map after the page loads
        window.onload = initMap;
    </script>
</body>
</html>